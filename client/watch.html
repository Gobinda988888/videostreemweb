<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>üî• Watch Video - AV Site</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            lineClamp: {
              2: '2',
            }
          }
        }
      }
    </script>
    <style>
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      .gradient-bg {
        background: linear-gradient(-45deg, #1a1a1a, #2d1b1b, #1a1a1a, #2d1b1b);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
      }
      .glow-red {
        box-shadow: 0 0 30px rgba(239, 68, 68, 0.3);
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Custom video player styles */
      .video-wrapper {
        position: relative;
        background: #000;
        border-radius: 16px;
        overflow: hidden;
      }

      .big-play-btn {
        display: none;
        position: absolute;
        inset: 0;
        z-index: 25;
        align-items: center;
        justify-content: center;
        pointer-events: auto;
      }
      
      .big-play-btn button {
        pointer-events: auto;
      }
      
      video {
        width: 100%;
        height: auto;
        display: block;
        max-height: 70vh;
        object-fit: contain;
      }
      
      .video-info {
        padding: 24px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
      }
      
      /* Mobile optimizations */
      @media (max-width: 768px) {
        video {
          max-height: 50vh;
          border-radius: 0;
        }
        .video-wrapper {
          border-radius: 0;
        }
        .video-info {
          padding: 12px;
        }
        .custom-controls {
          padding: 8px 12px;
        }
        .control-buttons {
          gap: 4px;
          flex-wrap: nowrap;
        }
        .control-btn {
          padding: 6px;
        }
        .volume-control {
          gap: 4px;
        }
        .volume-slider {
          width: 50px;
        }
        .time-display {
          font-size: 11px;
        }
        #speedSelect {
          font-size: 11px;
          padding: 4px 6px;
        }
        .gradient-bg {
          animation: none;
          background: #1a1a1a;
        }
        main {
          padding: 0 !important;
        }
        .big-play-btn button {
          padding: 16px !important;
        }
        .big-play-btn svg {
          width: 48px !important;
          height: 48px !important;
        }
      }
      
      .custom-controls {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.9));
        padding: 20px;
        opacity: 1;
        transition: opacity 0.3s;
        z-index: 20;
        pointer-events: auto;
      }
      
      .custom-controls * {
        pointer-events: auto;
      }
      
      .progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(255,255,255,0.3);
        border-radius: 2px;
        cursor: pointer;
        margin-bottom: 12px;
        position: relative;
        transition: height 0.2s;
      }
      
      .progress-bar:hover {
        height: 6px;
      }
      
      @media (max-width: 768px) {
        .progress-bar {
          height: 6px;
          margin-bottom: 10px;
          background: rgba(255,255,255,0.4);
        }
        
        .progress-bar:active {
          height: 8px;
        }
      }
      
      .progress-filled {
        height: 100%;
        background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        border-radius: 2px;
        transition: width 0.1s;
        position: relative;
      }
      
      .progress-filled::after {
        content: '';
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        background: #ef4444;
        border-radius: 50%;
        box-shadow: 0 0 8px rgba(239, 68, 68, 0.8);
        opacity: 0;
        transition: opacity 0.2s;
      }
      
      .progress-bar:hover .progress-filled::after {
        opacity: 1;
      }
      
      @media (max-width: 768px) {
        .progress-filled::after {
          width: 14px;
          height: 14px;
        }
      }
      
      .control-buttons {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .control-btn {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .control-btn:hover {
        background: rgba(255,255,255,0.1);
        transform: scale(1.1);
      }
      
      .time-display {
        color: white;
        font-size: 14px;
        margin-left: auto;
      }
      
      .volume-control {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .volume-slider {
        width: 80px;
        height: 4px;
        -webkit-appearance: none;
        background: rgba(255,255,255,0.2);
        border-radius: 2px;
        outline: none;
      }
      
      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 12px;
        height: 12px;
        background: #ef4444;
        border-radius: 50%;
        cursor: pointer;
      }
      
      .loading-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
      }
      
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255,255,255,0.1);
        border-top-color: #ef4444;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Light Mode */
      body.light-mode {
        background: linear-gradient(-45deg, #f5f5f5, #fce7e7, #f5f5f5, #fce7e7);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        color: #1a1a1a;
      }
      
      body.light-mode nav {
        background: rgba(255, 255, 255, 0.8);
        border-bottom-color: #fca5a5;
      }
      
      body.light-mode .bg-gray-900,
      body.light-mode .bg-gray-800 {
        background: rgba(255, 255, 255, 0.9);
        border-color: #fca5a5;
      }
      
      body.light-mode .bg-gray-700 {
        background: #f3f4f6;
      }
      
      body.light-mode .text-white {
        color: #1a1a1a;
      }
      
      body.light-mode .text-gray-400,
      body.light-mode .text-gray-300 {
        color: #6b7280;
      }
      
      body.light-mode .text-red-400 {
        color: #dc2626;
      }
      
      body.light-mode .border-red-900,
      body.light-mode .border-gray-700 {
        border-color: #fca5a5;
      }
      
      body.light-mode #themeToggle {
        background: #e5e7eb;
      }
    </style>
  </head>
  <body class="gradient-bg text-white min-h-screen">
    <nav class="bg-black bg-opacity-60 backdrop-blur-md p-4 sticky top-0 z-50 border-b border-red-900">
      <div class="max-w-7xl mx-auto flex justify-between items-center">
        <a href="/" class="flex items-center gap-2 hover:scale-105 transition-transform group">
          <div class="relative">
            <div class="absolute inset-0 bg-gradient-to-r from-red-500 to-pink-500 blur-lg opacity-50 group-hover:opacity-75 transition"></div>
            <svg width="35" height="35" viewBox="0 0 40 40" class="relative">
              <defs>
                <linearGradient id="logoGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                </linearGradient>
              </defs>
              <circle cx="20" cy="20" r="18" fill="url(#logoGradient2)" opacity="0.2"/>
              <path d="M15 12 L15 28 L28 20 Z" fill="url(#logoGradient2)"/>
              <circle cx="20" cy="20" r="18" fill="none" stroke="url(#logoGradient2)" stroke-width="2"/>
            </svg>
          </div>
          <span class="text-xl font-black bg-gradient-to-r from-red-500 via-pink-500 to-red-500 bg-clip-text text-transparent tracking-tight">
            desiixvideo
          </span>
        </a>
        
        <div class="flex items-center gap-3">
          <!-- Mobile Menu Button -->
          <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
          </button>
          
          <!-- Desktop Navigation -->
          <div class="hidden md:flex space-x-4 items-center">
          <button id="themeToggle" class="p-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition" title="Toggle theme">
            <svg id="sunIcon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="hidden">
              <path d="M12 17.5C9.5 17.5 7.5 15.5 7.5 13S9.5 8.5 12 8.5 16.5 10.5 16.5 13 14.5 17.5 12 17.5zM12 7C11.4 7 11 6.6 11 6V3c0-.6.4-1 1-1s1 .4 1 1v3c0 .6-.4 1-1 1zm0 14c-.6 0-1-.4-1-1v-3c0-.6.4-1 1-1s1 .4 1 1v3c0 .6-.4 1-1 1zM6 13c0-.6-.4-1-1-1H2c-.6 0-1 .4-1 1s.4 1 1 1h3c.6 0 1-.4 1-1zm17-1h-3c-.6 0-1 .4-1 1s.4 1 1 1h3c.6 0 1-.4 1-1s-.4-1-1-1zM7.05 18.36c-.4-.4-.4-1 0-1.41l2.12-2.12c.4-.4 1-.4 1.41 0 .4.4.4 1 0 1.41l-2.12 2.12c-.39.4-1.02.4-1.41 0zm8.49-8.49c-.4-.4-.4-1 0-1.41l2.12-2.12c.4-.4 1-.4 1.41 0 .4.4.4 1 0 1.41l-2.12 2.12c-.4.4-1.02.4-1.41 0zM8.46 7.05c.4-.4 1-.4 1.41 0 .4.4.4 1 0 1.41L7.76 10.6c-.4.4-1 .4-1.41 0-.4-.4-.4-1 0-1.41l2.11-2.14zm8.49 8.49c.4-.4 1-.4 1.41 0l2.12 2.12c.4.4.4 1 0 1.41-.4.4-1 .4-1.41 0l-2.12-2.12c-.4-.39-.4-1.02 0-1.41z"/>
            </svg>
            <svg id="moonIcon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"/>
            </svg>
          </button>
          <a href="/" class="hover:text-red-400 transition">üè† Home</a>
          <button id="logoutBtn" class="hover:text-red-400 transition">Logout</button>
          </div>
        </div>
      </div>
      
      <!-- Mobile Menu Slide-out -->
      <div id="mobileMenu" class="fixed inset-0 bg-black bg-opacity-90 backdrop-blur-md z-50 transform translate-x-full transition-transform duration-300 md:hidden">
        <div class="flex flex-col h-full p-6">
          <div class="flex justify-between items-center mb-8">
            <span class="text-2xl font-bold bg-gradient-to-r from-red-500 to-pink-500 bg-clip-text text-transparent">Menu</span>
            <button id="closeMobileMenu" class="p-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"/>
              </svg>
            </button>
          </div>
          
          <div class="flex flex-col space-y-4 text-lg">
            <button id="mobileThemeToggle" class="flex items-center gap-3 p-3 rounded-lg bg-gray-800 hover:bg-gray-700 transition">
              <span>üåô</span> Toggle Theme
            </button>
            <a href="/" class="p-3 hover:text-red-400 transition">üè† Home</a>
            <button id="mobileLogoutBtn" class="p-3 text-left hover:text-red-400 transition">Logout</button>
          </div>
        </div>
      </div>
    </nav>

    <main class="p-6 max-w-6xl mx-auto">
      <div id="videoContainer" class="bg-gray-900 bg-opacity-60 backdrop-blur-sm rounded-2xl border border-red-900 overflow-hidden glow-red">
        <div class="flex items-center justify-center h-64">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-red-500 border-t-transparent mb-4"></div>
            <p class="text-gray-400">Loading video...</p>
          </div>
        </div>
      </div>
      
      <!-- Favorite Button (will be shown after video loads) -->
      <div id="favoriteButton" class="hidden mt-4 text-center">
        <button onclick="toggleFavorite()" id="favBtn" class="bg-red-600 hover:bg-red-700 px-6 py-3 rounded-lg transition inline-flex items-center gap-2 text-lg">
          <span id="favIcon">‚ù§Ô∏è</span>
          <span id="favText">Add to Favorites</span>
        </button>
      </div>
    </main>

    <script src="/js/app.js"></script>
    <script>
      let currentVideo = null;
      
      // Track watch history
      const params = new URLSearchParams(window.location.search);
      const videoId = params.get('id');
      
      if (videoId) {
        // Fetch video details for history
        fetch('/api/videos/' + videoId)
          .then(r => r.json())
          .then(data => {
            currentVideo = data;
            
            // Save to watch history
            const history = JSON.parse(localStorage.getItem('watchHistory') || '[]');
            
            // Remove if already exists (to update timestamp)
            const filtered = history.filter(item => item.id !== videoId);
            
            // Add to beginning of array with full video data
            filtered.unshift({
              id: videoId,
              title: data.title,
              thumbnail: data.thumbnailUrl,
              views: data.views,
              watchedAt: new Date().toISOString()
            });
            
            // Keep only last 50 videos
            const limited = filtered.slice(0, 50);
            
            localStorage.setItem('watchHistory', JSON.stringify(limited));
            
            // Show favorite button
            document.getElementById('favoriteButton').classList.remove('hidden');
            updateFavoriteButton();
          })
          .catch(err => console.error('Error loading video:', err));
      }
      
      // Toggle favorite
      function toggleFavorite() {
        if (!currentVideo) return;
        
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const isFavorite = favorites.some(v => v.id === currentVideo._id);
        
        if (isFavorite) {
          // Remove from favorites
          favorites = favorites.filter(v => v.id !== currentVideo._id);
          localStorage.setItem('favorites', JSON.stringify(favorites));
        } else {
          // Add to favorites
          favorites.unshift({
            id: currentVideo._id,
            title: currentVideo.title,
            thumbnail: currentVideo.thumbnailUrl,
            views: currentVideo.views,
            addedAt: new Date().toISOString()
          });
          localStorage.setItem('favorites', JSON.stringify(favorites));
        }
        
        updateFavoriteButton();
      }
      
      // Update favorite button appearance
      function updateFavoriteButton() {
        if (!currentVideo) return;
        
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const isFavorite = favorites.some(v => v.id === currentVideo._id);
        
        const favBtn = document.getElementById('favBtn');
        const favIcon = document.getElementById('favIcon');
        const favText = document.getElementById('favText');
        
        if (isFavorite) {
          favBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
          favBtn.classList.add('bg-pink-600', 'hover:bg-pink-700');
          favIcon.textContent = 'üíñ';
          favText.textContent = 'Remove from Favorites';
        } else {
          favBtn.classList.remove('bg-pink-600', 'hover:bg-pink-700');
          favBtn.classList.add('bg-red-600', 'hover:bg-red-700');
          favIcon.textContent = '‚ù§Ô∏è';
          favText.textContent = 'Add to Favorites';
        }
      }
      
      // Mobile menu functionality
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      const closeMobileMenu = document.getElementById('closeMobileMenu');
      const mobileThemeToggle = document.getElementById('mobileThemeToggle');
      const themeToggle = document.getElementById('themeToggle');
      const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      
      mobileMenuBtn?.addEventListener('click', () => {
        mobileMenu.style.transform = 'translateX(0)';
      });
      
      closeMobileMenu?.addEventListener('click', () => {
        mobileMenu.style.transform = 'translateX(100%)';
      });
      
      // Close menu on link click
      mobileMenu?.querySelectorAll('a, button').forEach(item => {
        item.addEventListener('click', () => {
          if (item.id !== 'closeMobileMenu' && item.id !== 'mobileThemeToggle' && item.id !== 'mobileLogoutBtn') {
            mobileMenu.style.transform = 'translateX(100%)';
          }
        });
      });
      
      // Mobile theme toggle
      mobileThemeToggle?.addEventListener('click', () => {
        themeToggle?.click();
      });
      
      // Mobile logout
      mobileLogoutBtn?.addEventListener('click', () => {
        logoutBtn?.click();
      });
    </script>
  </body>
</html>
