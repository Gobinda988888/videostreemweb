<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Admin Password Reset - desiixvideo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">üîß Admin Password Reset</h1>
        
        <div class="bg-gray-800 p-6 rounded-lg mb-6">
            <h2 class="text-xl font-bold mb-4 text-yellow-400">Reset Admin Password</h2>
            <p class="mb-4 text-gray-300">Click the button below to reset admin password to default:</p>
            
            <button onclick="resetPassword()" class="w-full p-3 bg-red-600 hover:bg-red-700 rounded font-semibold mb-3">
                üîÑ Reset Admin Password
            </button>
            
            <div id="result" class="mt-4 p-4 rounded hidden"></div>
        </div>

        <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-bold mb-4 text-blue-400">Test Login After Reset</h2>
            <form id="loginForm" class="space-y-3">
                <input type="email" id="email" value="admin@example.com" class="w-full p-2 bg-gray-700 rounded" placeholder="Email" />
                <input type="password" id="password" value="admin123" class="w-full p-2 bg-gray-700 rounded" placeholder="Password" />
                <button type="submit" class="w-full p-3 bg-blue-600 hover:bg-blue-700 rounded font-semibold">
                    üîê Test Login
                </button>
            </form>
            <div id="loginResult" class="mt-4 p-4 rounded hidden"></div>
        </div>

        <div class="mt-6 p-4 bg-yellow-900 rounded-lg">
            <p class="text-yellow-200">
                ‚ö†Ô∏è <strong>Warning:</strong> This is an emergency tool. Remove this endpoint in production!
            </p>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin + '/api';

        async function resetPassword() {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = '‚è≥ Resetting password...';
            resultDiv.className = 'mt-4 p-4 rounded bg-blue-600';
            resultDiv.classList.remove('hidden');

            try {
                const response = await fetch(`${API_BASE}/admin/reset-admin-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'mt-4 p-4 rounded bg-green-600';
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>Password Reset Successful!</strong><br><br>
                        <strong>Email:</strong> ${data.email}<br>
                        <strong>Password:</strong> ${data.password || 'admin123'}<br><br>
                        Now try logging in with these credentials!
                    `;
                } else {
                    resultDiv.className = 'mt-4 p-4 rounded bg-red-600';
                    resultDiv.textContent = '‚ùå Error: ' + data.message;
                }
            } catch (err) {
                resultDiv.className = 'mt-4 p-4 rounded bg-red-600';
                resultDiv.textContent = '‚ùå Error: ' + err.message;
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('loginResult');

            resultDiv.textContent = '‚è≥ Logging in...';
            resultDiv.className = 'mt-4 p-4 rounded bg-blue-600';
            resultDiv.classList.remove('hidden');

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'mt-4 p-4 rounded bg-green-600';
                    
                    // Decode JWT
                    const payload = JSON.parse(atob(data.token.split('.')[1]));
                    
                    resultDiv.innerHTML = `
                        ‚úÖ <strong>Login Successful!</strong><br><br>
                        <strong>Email:</strong> ${payload.email}<br>
                        <strong>Is Admin:</strong> ${payload.isAdmin ? 'Yes ‚úÖ' : 'No ‚ùå'}<br>
                        <strong>Token:</strong> ${data.token.substring(0, 50)}...<br><br>
                        <a href="/admin.html" class="text-blue-300 underline">Go to Admin Panel ‚Üí</a>
                    `;
                    
                    // Save token
                    localStorage.setItem('token', data.token);
                } else {
                    resultDiv.className = 'mt-4 p-4 rounded bg-red-600';
                    resultDiv.textContent = '‚ùå Login Failed: ' + data.message;
                }
            } catch (err) {
                resultDiv.className = 'mt-4 p-4 rounded bg-red-600';
                resultDiv.textContent = '‚ùå Error: ' + err.message;
            }
        });
    </script>
</body>
</html>
