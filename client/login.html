<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>üî• Login - AV Site</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      .gradient-bg {
        background: linear-gradient(-45deg, #1a1a1a, #2d1b1b, #1a1a1a, #2d1b1b);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
      }
    </style>
  </head>
  <body class="gradient-bg text-white min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
      <div class="text-center mb-8">
        <div class="flex items-center justify-center gap-3 mb-2">
          <svg width="50" height="50" viewBox="0 0 40 40">
            <defs>
              <linearGradient id="logoGradient3" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
              </linearGradient>
            </defs>
            <circle cx="20" cy="20" r="18" fill="url(#logoGradient3)" opacity="0.2"/>
            <path d="M15 12 L15 28 L28 20 Z" fill="url(#logoGradient3)"/>
            <circle cx="20" cy="20" r="18" fill="none" stroke="url(#logoGradient3)" stroke-width="2"/>
          </svg>
          <h1 class="text-4xl font-black bg-gradient-to-r from-red-500 via-pink-500 to-red-500 bg-clip-text text-transparent tracking-tight">desiixvideo</h1>
        </div>
        <p class="text-gray-400">Welcome back!</p>
      </div>
      <div class="bg-gray-900 bg-opacity-60 backdrop-blur-sm p-8 rounded-2xl border border-red-900 shadow-2xl">
        <h2 class="text-3xl font-bold mb-6 text-center">Login</h2>
        
        <!-- Already logged in message -->
        <div id="alreadyLoggedIn" class="hidden mb-4 p-4 bg-green-900 bg-opacity-50 border border-green-600 rounded-lg">
          <p class="text-green-300 text-center mb-3">‚úÖ You are already logged in!</p>
          <a href="/" class="block w-full p-2 text-center bg-green-600 hover:bg-green-700 rounded font-semibold">Go to Home</a>
        </div>

        <form id="loginForm" class="space-y-4">
          <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">üìß</span>
            <input aria-label="email" name="email" type="email" placeholder="Email" class="w-full pl-10 p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-red-500 focus:outline-none transition" required />
          </div>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">üîí</span>
            <input aria-label="password" name="password" type="password" placeholder="Password" class="w-full pl-10 p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-red-500 focus:outline-none transition" />
          </div>
          <div id="loginError" class="hidden text-red-400 text-sm"></div>
          <button type="submit" class="w-full p-3 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 rounded-lg font-semibold transform hover:scale-105 transition">
            üîê Login
          </button>
        </form>
        <p class="mt-4 text-sm text-center text-gray-400">
          <a href="/forgot-password.html" class="text-red-400 hover:text-red-300 font-semibold">Forgot Password?</a>
        </p>
        <p class="mt-2 text-sm text-center text-gray-400">Don't have an account? <a href="/register.html" class="text-red-400 hover:text-red-300 font-semibold">Register</a></p>
      </div>
    </div>

    <script src="/js/app.js"></script>
    <script>
      // Inline login handler as backup
      document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('loginForm');
        if (form) {
          console.log('‚úÖ Inline login handler loaded');
          form.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('üîê Form submitted via inline handler');
            
            const email = form.email.value;
            const password = form.password.value;
            
            if (!email || !password) {
              document.getElementById('loginError').textContent = 'Please enter email and password';
              document.getElementById('loginError').classList.remove('hidden');
              return;
            }
            
            try {
              const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
              });
              
              const data = await response.json();
              
              if (!response.ok) {
                throw new Error(data.message || 'Login failed');
              }
              
              console.log('‚úÖ Login successful!');
              localStorage.setItem('token', data.token);
              
              // Decode token to check if admin
              try {
                const payload = JSON.parse(atob(data.token.split('.')[1]));
                if (payload.isAdmin) {
                  console.log('üëë Admin detected, redirecting to dashboard...');
                  window.location.href = '/admin.html';
                } else {
                  console.log('üë§ Regular user, redirecting to home...');
                  window.location.href = '/';
                }
              } catch (err) {
                console.error('Error decoding token:', err);
                window.location.href = '/';
              }
            } catch (err) {
              console.error('‚ùå Login error:', err);
              const errEl = document.getElementById('loginError');
              errEl.textContent = 'Login failed: ' + err.message;
              errEl.classList.remove('hidden');
            }
          });
        }
      });
    </script>
  </body>
</html>
